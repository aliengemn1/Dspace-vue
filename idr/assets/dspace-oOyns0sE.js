import{a as y}from"./utils-B9ygI19o.js";import{i as d,s as m}from"./index-BAXmnS_s.js";const g="http://localhost:8080/server/api",s=y.create({baseURL:g,timeout:3e4,headers:{"Content-Type":"application/json",Accept:"application/json"},withCredentials:!0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN"});let c=null,p=null;s.interceptors.request.use(e=>(c&&(e.headers["X-XSRF-TOKEN"]=c),p&&(e.headers.Authorization=`Bearer ${p}`),e),e=>Promise.reject(e));s.interceptors.response.use(e=>{const t=e.headers["dspace-xsrf-token"];return t&&(c=t),e},e=>{if(e.response)switch(e.response.status){case 401:p=null,c=null,localStorage.removeItem("authToken");break;case 403:console.error("Forbidden access");break;case 404:console.error("Resource not found");break;case 500:console.error("Server error");break}return Promise.reject(e)});function n(e){if(!d(e))throw new Error("Invalid resource identifier")}const f={async getAll(e={}){return(await s.get("/core/communities",{params:e})).data},async getTopLevel(e={}){return(await s.get("/core/communities/search/top",{params:e})).data},async getById(e){return n(e),(await s.get(`/core/communities/${e}`)).data},async getSubcommunities(e,t={}){return n(e),(await s.get(`/core/communities/${e}/subcommunities`,{params:t})).data},async getCollections(e,t={}){return n(e),(await s.get(`/core/communities/${e}/collections`,{params:t})).data}},b={async getAll(e={}){return(await s.get("/core/collections",{params:e})).data},async getById(e){return n(e),(await s.get(`/core/collections/${e}`)).data},async getItems(e,t={}){return n(e),(await s.get("/discover/search/objects",{params:{...t,scope:e,dsoType:"item"}})).data}},T={async getAll(e={}){return(await s.get("/core/items",{params:e})).data},async getById(e){return n(e),(await s.get(`/core/items/${e}`)).data},async getBundles(e){return n(e),(await s.get(`/core/items/${e}/bundles`)).data},async getMetadata(e){return n(e),(await this.getById(e)).metadata},async getRecent(e=10){return(await s.get("/discover/search/objects",{params:{sort:"dc.date.accessioned,DESC",size:e,dsoType:"item"}})).data}},$={async getById(e){return n(e),(await s.get(`/core/bitstreams/${e}`)).data},getContentUrl(e){return d(e)?`${s.defaults.baseURL}/core/bitstreams/${e}/content`:null},async getByBundle(e){return n(e),(await s.get(`/core/bundles/${e}/bitstreams`)).data}},S={async query(e={}){const t={...e};return t.query&&(t.query=m(t.query)),(await s.get("/discover/search/objects",{params:{...t,dsoType:t.dsoType||"item"}})).data},async getFacets(e={}){return(await s.get("/discover/facets",{params:e})).data},async searchWithFacets(e,t={},r={}){const o={query:m(e),...r};return Object.entries(t).forEach(([i,u])=>{Array.isArray(u)&&u.length>0&&(o[`f.${i}`]=u.map(l=>typeof l=="string"?m(l):l))}),this.query(o)}},k={async byIndex(e,t={}){return(await s.get(`/discover/browses/${e}/entries`,{params:t})).data},async getIndices(){return(await s.get("/discover/browses")).data},async getItemsByEntry(e,t,r={}){return(await s.get(`/discover/browses/${e}/items`,{params:{...r,filterValue:t}})).data}},v={async getSiteStats(){try{return(await s.get("/statistics/usagereports/search/object",{params:{uri:"site"}})).data}catch{return{totalVisits:0,totalDownloads:0}}},async getRepositorySummary(){var e,t,r;try{const[a,o,i]=await Promise.all([s.get("/core/communities",{params:{size:1}}),s.get("/core/collections",{params:{size:1}}),s.get("/core/items",{params:{size:1}})]);return{communities:((e=a.data.page)==null?void 0:e.totalElements)||0,collections:((t=o.data.page)==null?void 0:t.totalElements)||0,items:((r=i.data.page)==null?void 0:r.totalElements)||0}}catch(a){return console.error("Failed to get repository summary:",a),{communities:0,collections:0,items:0}}}},I={getMetadataValue(e,t,r=!1){const a=e[t];return!a||a.length===0?r?[]:null:r?a.map(o=>o.value):a[0].value},formatDate(e){return e?new Date(e).toLocaleDateString("ar-SA",{year:"numeric",month:"long",day:"numeric"}):""},getThumbnailUrl(e){var t,r;return(r=(t=e._links)==null?void 0:t.thumbnail)!=null&&r.href?e._links.thumbnail.href:null}};export{S as a,k as b,f as c,b as d,$ as e,T as i,v as s,I as u};
