import{s as f,b as c,i as w}from"./index-C9hMAXH0.js";class p{constructor(t=5*60*1e3){this.cache=new Map,this.ttl=t}generateKey(t,s={}){return`${t}:${JSON.stringify(s)}`}get(t){const s=this.cache.get(t);return s?Date.now()-s.timestamp>this.ttl?(this.cache.delete(t),null):s.data:null}set(t,s){this.cache.set(t,{data:s,timestamp:Date.now()})}delete(t){this.cache.delete(t)}clear(){this.cache.clear()}cleanup(){const t=Date.now();for(const[s,a]of this.cache.entries())t-a.timestamp>this.ttl&&this.cache.delete(s)}}const h=new p(10*60*1e3),o=new p(2*60*1e3),y=new p(5*60*1e3),g=new p(15*60*1e3);setInterval(()=>{h.cleanup(),o.cleanup(),y.cleanup(),g.cleanup()},60*1e3);function i(e){if(!w(e))throw new Error("Invalid resource identifier")}const B={async getAll(e={}){return(await c.get("/core/communities",{params:e})).data},async getTopLevel(e={}){return(await c.get("/core/communities/search/top",{params:e})).data},async getById(e){return i(e),(await c.get(`/core/communities/${e}`)).data},async getSubcommunities(e,t={}){return i(e),(await c.get(`/core/communities/${e}/subcommunities`,{params:t})).data},async getCollections(e,t={}){return i(e),(await c.get(`/core/communities/${e}/collections`,{params:t})).data}},D={async getAll(e={}){return(await c.get("/core/collections",{params:e})).data},async getById(e){return i(e),(await c.get(`/core/collections/${e}`)).data},async getItems(e,t={}){return i(e),(await c.get("/discover/search/objects",{params:{...t,scope:e,dsoType:"item"}})).data}},z={async getAll(e={}){return(await c.get("/core/items",{params:e})).data},async getById(e,t=!0){if(i(e),t){const a=y.generateKey("item",{id:e}),r=y.get(a);if(r)return console.log("Item cache hit:",e),r}const s=await c.get(`/core/items/${e}`);if(t){const a=y.generateKey("item",{id:e});y.set(a,s.data)}return s.data},async getBundles(e){return i(e),(await c.get(`/core/items/${e}/bundles`)).data},async getMetadata(e){return i(e),(await this.getById(e)).metadata},async getRecent(e=10,t=!0){const s={sort:"dc.date.accessioned,DESC",size:e,dsoType:"item"};if(t){const r=o.generateKey("recent",s),n=o.get(r);if(n)return console.log("Recent items cache hit"),n}const a=await c.get("/discover/search/objects",{params:s});if(t){const r=o.generateKey("recent",s);o.set(r,a.data)}return a.data},clearCache(){y.clear(),console.log("Item cache cleared")}},E={async getById(e){return i(e),(await c.get(`/core/bitstreams/${e}`)).data},getContentUrl(e){return w(e)?`${c.defaults.baseURL}/core/bitstreams/${e}/content`:null},async getByBundle(e){return i(e),(await c.get(`/core/bundles/${e}/bitstreams`)).data}},R={async query(e={},t=!0){const s={...e};s.query&&(s.query=f(s.query));const a={...s,dsoType:s.dsoType||"item"};if(t){const n=o.generateKey("search",a),l=o.get(n);if(l)return console.log("Search cache hit:",n),l}const r=await c.get("/discover/search/objects",{params:a});if(t){const n=o.generateKey("search",a);o.set(n,r.data)}return r.data},async getFacets(e={},t=!0){if(t){const a=h.generateKey("facets",e),r=h.get(a);if(r)return console.log("Facets cache hit:",a),r}const s=await c.get("/discover/facets",{params:e});if(t){const a=h.generateKey("facets",e);h.set(a,s.data)}return s.data},async searchWithFacets(e,t={},s={},a=!0){const n={query:f(e),...s};return Object.entries(t).forEach(([l,m])=>{Array.isArray(m)&&m.length>0&&(n[`f.${l}`]=m.map(u=>typeof u=="string"?f(u):u))}),this.query(n,a)},clearCache(){o.clear(),h.clear(),console.log("Search cache cleared")}},A={async byIndex(e,t={}){return(await c.get(`/discover/browses/${e}/entries`,{params:t})).data},async getIndices(){return(await c.get("/discover/browses")).data},async getItemsByEntry(e,t,s={}){return(await c.get(`/discover/browses/${e}/items`,{params:{...s,filterValue:t}})).data}},j={async getSiteStats(e=!0){const t="site-stats";if(e){const s=g.get(t);if(s)return console.log("Site stats cache hit"),s}try{const s=await c.get("/statistics/usagereports/search/object",{params:{uri:"site"}});return e&&g.set(t,s.data),s.data}catch{return{totalVisits:0,totalDownloads:0}}},async getItemStats(e,t=!0){var a;if(!w(e))return{views:0,downloads:0};const s=`item-stats:${e}`;if(t){const r=g.get(s);if(r)return console.log("Item stats cache hit:",e),r}try{const n=((a=(await c.get("/statistics/usagereports/search/object",{params:{uri:`urn:dspace:item:${e}`}})).data._embedded)==null?void 0:a.usagereports)||[];let l=0,m=0;n.forEach(d=>{var b,K,$,v,S,I;d.reportType==="TotalVisits"&&(l=(($=(K=(b=d.points)==null?void 0:b[0])==null?void 0:K.values)==null?void 0:$.views)||0),d.reportType==="TotalDownloads"&&(m=((I=(S=(v=d.points)==null?void 0:v[0])==null?void 0:S.values)==null?void 0:I.downloads)||0)});const u={views:l,downloads:m};return t&&g.set(s,u),u}catch(r){return console.error("Failed to get item statistics:",r),{views:0,downloads:0}}},async getRepositorySummary(e=!0){var s,a,r;const t="repository-summary";if(e){const n=g.get(t);if(n)return console.log("Repository summary cache hit"),n}try{const[n,l,m]=await Promise.all([c.get("/core/communities",{params:{size:1}}),c.get("/core/collections",{params:{size:1}}),c.get("/core/items",{params:{size:1}})]),u={communities:((s=n.data.page)==null?void 0:s.totalElements)||0,collections:((a=l.data.page)==null?void 0:a.totalElements)||0,items:((r=m.data.page)==null?void 0:r.totalElements)||0};return e&&g.set(t,u),u}catch(n){return console.error("Failed to get repository summary:",n),{communities:0,collections:0,items:0}}},clearCache(){g.clear(),console.log("Statistics cache cleared")}},q={getMetadataValue(e,t,s=!1){const a=e[t];return!a||a.length===0?s?[]:null:s?a.map(r=>r.value):a[0].value},formatDate(e){return e?new Date(e).toLocaleDateString("ar-SA",{year:"numeric",month:"long",day:"numeric"}):""},getThumbnailUrl(e){var t,s;return(s=(t=e._links)==null?void 0:t.thumbnail)!=null&&s.href?e._links.thumbnail.href:null}};export{R as a,A as b,D as c,B as d,E as e,z as i,j as s,q as u};
