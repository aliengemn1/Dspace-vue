import{r as n,c as D,o as re,J as ne,w as ce,k as i,m as t,j as Z,t as o,p as I,n as h,F as V,u as x,B as J,A as ue,x as M,z as de,l}from"./vue-vendor-CZlwpbXF.js";import{u as ve}from"./i18n-CCTaJ8OG.js";import{_ as he,S as pe}from"./index-BAXmnS_s.js";import{I as be}from"./ItemCard-DGwLc-Wa.js";import{B as _e}from"./Breadcrumb-BCSQGoOZ.js";import{P as fe}from"./Pagination-CYeSEOLn.js";import{a as W,u as b}from"./dspace-oOyns0sE.js";import"./utils-B9ygI19o.js";const ge={class:"search-view"},ye={class:"breadcrumb-section"},me={class:"container"},ke={class:"search-header"},we={class:"container"},Ce={class:"page-title"},Ve={class:"search-box-wrapper"},xe={class:"search-content"},$e={class:"container"},Be={class:"search-layout"},Se={class:"filters-header"},je={class:"filters-title"},Fe={key:0,class:"filter-group"},qe={class:"filter-group-title"},Ie={class:"filter-options"},Me=["checked","onChange"],Ae={class:"filter-label"},Ee={class:"filter-count"},Pe={key:1,class:"filter-group"},Re={class:"filter-group-title"},Oe={class:"filter-options"},De=["checked","onChange"],Ne={class:"filter-label"},Le={class:"filter-count"},ze={key:2,class:"filter-group"},Ge={class:"filter-group-title"},Te={class:"filter-options"},Ue=["checked","onChange"],Ze={class:"filter-label"},Je={class:"filter-count"},We={key:3,class:"filter-group"},He={class:"filter-group-title"},Ke={class:"filter-options"},Qe=["checked","onChange"],Xe={class:"filter-label"},Ye={class:"filter-count"},et={key:4,class:"facets-loading"},tt={key:5,class:"no-facets"},st={class:"results-area"},at={class:"results-header"},lt={class:"results-info"},ot={key:0,class:"results-count"},it={class:"results-controls"},rt={class:"view-toggle"},nt=["aria-label"],ct=["aria-label"],ut={class:"sort-wrapper"},dt={for:"sort-select",class:"sort-label"},vt=["value"],ht=["value"],pt={key:0,class:"results-loading"},bt={key:1,class:"no-results"},_t={class:"no-results-title"},ft={class:"no-results-description"},gt={key:3,class:"search-initial"},H=12,yt={__name:"SearchView",setup(mt){const _=ne(),A=de(),{t:f}=ve(),u=n(""),E=n(!1),S=n(!1),g=n([]),w=n(0),y=n(1),K=[{value:"relevance",label:f("search.relevance")},{value:"date_desc",label:f("search.dateNewest")},{value:"date_asc",label:f("search.dateOldest")},{value:"title_asc",label:f("search.titleAZ")},{value:"title_desc",label:f("search.titleZA")}],P=n("relevance"),R=n(!1),$=n("grid"),O=n("all"),r=n({type:[],author:[],subject:[],dateIssued:[]}),c=n({type:[],author:[],subject:[],dateIssued:[]}),N={itemtype:{key:"type",label:"search.filterBy.type"},author:{key:"author",label:"search.filterBy.author"},subject:{key:"subject",label:"search.filterBy.subject"},dateIssued:{key:"dateIssued",label:"search.filterBy.date"}},L=D(()=>Math.ceil(w.value/H)),Q=D(()=>[{label:f("nav.home"),path:"/"},{label:f("nav.search"),path:"/search"}]);function X(e,a){u.value=e,a&&(O.value=a),y.value=1,p(),A.push({query:{q:e,page:1,category:O.value}})}function Y(e){O.value=e,u.value&&(p(),A.push({query:{..._.query,category:e}}))}function z(e){$.value=e}function ee(e){return{relevance:"score,DESC",date_desc:"dc.date.issued,DESC",date_asc:"dc.date.issued,ASC",title_asc:"dc.title,ASC",title_desc:"dc.title,DESC"}[e]||"score,DESC"}async function te(){var e;S.value=!0;try{const a=await W.getFacets();(e=a._embedded)!=null&&e.facets&&a._embedded.facets.forEach(s=>{var B;const d=N[s.name];d&&((B=s._embedded)!=null&&B.values)&&(c.value[d.key]=s._embedded.values.map(m=>({value:m.label||m.value,count:m.count||0,filterValue:m.value})))})}catch(a){console.error("Failed to load facets:",a)}finally{S.value=!1}}function se(e){const a=e.metadata||{};return{id:e.uuid||e.id,title:b.getMetadataValue(a,"dc.title")||"بدون عنوان",author:b.getMetadataValue(a,"dc.contributor.author")||b.getMetadataValue(a,"dc.creator")||"غير معروف",date:b.getMetadataValue(a,"dc.date.issued")||"",type:b.getMetadataValue(a,"dc.type")||"غير محدد",collection:b.getMetadataValue(a,"dc.relation.ispartof")||"",thumbnail:b.getThumbnailUrl(e),abstract:b.getMetadataValue(a,"dc.description.abstract")}}async function p(){var e,a,s,d,B,m,G,T;if(!u.value.trim()){g.value=[],w.value=0;return}E.value=!0;try{const F={};Object.entries(r.value).forEach(([k,v])=>{Array.isArray(v)&&v.length>0&&(F[k]=v)});const C=await W.searchWithFacets(u.value,F,{page:y.value-1,size:H,sort:ee(P.value)});(s=(a=(e=C._embedded)==null?void 0:e.searchResult)==null?void 0:a._embedded)!=null&&s.objects?g.value=C._embedded.searchResult._embedded.objects.map(k=>{var v;return(v=k._embedded)==null?void 0:v.indexableObject}).filter(Boolean).map(se):g.value=[],w.value=((m=(B=(d=C._embedded)==null?void 0:d.searchResult)==null?void 0:B.page)==null?void 0:m.totalElements)||((G=C.page)==null?void 0:G.totalElements)||0,(T=C._embedded)!=null&&T.facets&&C._embedded.facets.forEach(k=>{var U;const v=N[k.name];v&&((U=k._embedded)!=null&&U.values)&&(c.value[v.key]=k._embedded.values.map(q=>({value:q.label||q.value,count:q.count||0,filterValue:q.value})))})}catch(F){console.error("Search failed:",F),g.value=[],w.value=0}finally{E.value=!1}}function ae(e){y.value=e,A.push({query:{..._.query,page:e}}),p()}function le(e){P.value=e.target.value,y.value=1,p()}function j(e,a){r.value[e]||(r.value[e]=[]);const s=r.value[e].indexOf(a);s>-1?r.value[e].splice(s,1):r.value[e].push(a),y.value=1,p()}function oe(){r.value={type:[],author:[],subject:[],dateIssued:[]},p()}const ie=D(()=>Object.values(r.value).some(e=>Array.isArray(e)&&e.length>0));return re(async()=>{await te(),_.query.q&&(u.value=_.query.q,p()),_.query.page&&(y.value=parseInt(_.query.page))}),ce(()=>_.query,e=>{e.q!==u.value&&(u.value=e.q||"",p())}),(e,a)=>(l(),i("div",ge,[t("div",ye,[t("div",me,[Z(_e,{items:Q.value},null,8,["items"])])]),t("div",ke,[t("div",we,[t("h1",Ce,o(e.$t("search.results")),1),t("div",Ve,[Z(pe,{modelValue:u.value,"onUpdate:modelValue":a[0]||(a[0]=s=>u.value=s),placeholder:e.$t("search.placeholder"),"show-advanced":!0,"show-categories":!0,onSearch:X,onCategoryChange:Y},null,8,["modelValue","placeholder"])])])]),t("div",xe,[t("div",$e,[t("div",Be,[t("aside",{class:I(["filters-sidebar",{"is-open":R.value}])},[t("div",Se,[t("h2",je,o(e.$t("search.filters")),1),ie.value?(l(),i("button",{key:0,class:"clear-filters-btn",onClick:oe},o(e.$t("common.clear")),1)):h("",!0)]),c.value.type.length>0?(l(),i("div",Fe,[t("h3",qe,o(e.$t("search.filterBy.type")),1),t("div",Ie,[(l(!0),i(V,null,x(c.value.type,s=>(l(),i("label",{key:s.filterValue,class:"filter-option"},[t("input",{type:"checkbox",checked:r.value.type.includes(s.filterValue),onChange:d=>j("type",s.filterValue)},null,40,Me),t("span",Ae,o(s.value),1),t("span",Ee,"("+o(s.count)+")",1)]))),128))])])):h("",!0),c.value.author.length>0?(l(),i("div",Pe,[t("h3",Re,o(e.$t("search.filterBy.author")),1),t("div",Oe,[(l(!0),i(V,null,x(c.value.author.slice(0,10),s=>(l(),i("label",{key:s.filterValue,class:"filter-option"},[t("input",{type:"checkbox",checked:r.value.author.includes(s.filterValue),onChange:d=>j("author",s.filterValue)},null,40,De),t("span",Ne,o(s.value),1),t("span",Le,"("+o(s.count)+")",1)]))),128))])])):h("",!0),c.value.subject.length>0?(l(),i("div",ze,[t("h3",Ge,o(e.$t("search.filterBy.subject")),1),t("div",Te,[(l(!0),i(V,null,x(c.value.subject.slice(0,10),s=>(l(),i("label",{key:s.filterValue,class:"filter-option"},[t("input",{type:"checkbox",checked:r.value.subject.includes(s.filterValue),onChange:d=>j("subject",s.filterValue)},null,40,Ue),t("span",Ze,o(s.value),1),t("span",Je,"("+o(s.count)+")",1)]))),128))])])):h("",!0),c.value.dateIssued.length>0?(l(),i("div",We,[t("h3",He,o(e.$t("search.filterBy.date")),1),t("div",Ke,[(l(!0),i(V,null,x(c.value.dateIssued.slice(0,10),s=>(l(),i("label",{key:s.filterValue,class:"filter-option"},[t("input",{type:"checkbox",checked:r.value.dateIssued.includes(s.filterValue),onChange:d=>j("dateIssued",s.filterValue)},null,40,Qe),t("span",Xe,o(s.value),1),t("span",Ye,"("+o(s.count)+")",1)]))),128))])])):h("",!0),S.value?(l(),i("div",et,[a[4]||(a[4]=t("div",{class:"spinner-small"},null,-1)),t("span",null,o(e.$t("common.loading")),1)])):h("",!0),!S.value&&Object.values(c.value).every(s=>s.length===0)?(l(),i("div",tt,[t("p",null,o(e.$t("search.noFiltersAvailable")||"ابحث للحصول على خيارات التصفية"),1)])):h("",!0)],2),t("main",st,[t("div",at,[t("div",lt,[t("button",{class:"filter-toggle hide-lg-up",onClick:a[1]||(a[1]=s=>R.value=!R.value)},[a[5]||(a[5]=t("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"})],-1)),ue(" "+o(e.$t("search.filters")),1)]),w.value>0?(l(),i("span",ot,o(e.$t("search.resultsCount",{count:w.value})),1)):h("",!0)]),t("div",it,[t("div",rt,[t("button",{class:I(["view-btn",{active:$.value==="grid"}]),onClick:a[2]||(a[2]=s=>z("grid")),"aria-label":e.$t("search.viewGrid")||"Grid view"},[...a[6]||(a[6]=[M('<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-228b3eec><rect x="3" y="3" width="7" height="7" data-v-228b3eec></rect><rect x="14" y="3" width="7" height="7" data-v-228b3eec></rect><rect x="14" y="14" width="7" height="7" data-v-228b3eec></rect><rect x="3" y="14" width="7" height="7" data-v-228b3eec></rect></svg>',1)])],10,nt),t("button",{class:I(["view-btn",{active:$.value==="list"}]),onClick:a[3]||(a[3]=s=>z("list")),"aria-label":e.$t("search.viewList")||"List view"},[...a[7]||(a[7]=[M('<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-228b3eec><line x1="8" y1="6" x2="21" y2="6" data-v-228b3eec></line><line x1="8" y1="12" x2="21" y2="12" data-v-228b3eec></line><line x1="8" y1="18" x2="21" y2="18" data-v-228b3eec></line><line x1="3" y1="6" x2="3.01" y2="6" data-v-228b3eec></line><line x1="3" y1="12" x2="3.01" y2="12" data-v-228b3eec></line><line x1="3" y1="18" x2="3.01" y2="18" data-v-228b3eec></line></svg>',1)])],10,ct)]),t("div",ut,[t("label",dt,o(e.$t("search.sortBy"))+":",1),t("select",{id:"sort-select",class:"sort-select",value:P.value,onChange:le},[(l(),i(V,null,x(K,s=>t("option",{key:s.value,value:s.value},o(s.label),9,ht)),64))],40,vt)])])]),E.value?(l(),i("div",pt,[a[8]||(a[8]=t("div",{class:"spinner"},null,-1)),t("span",null,o(e.$t("common.loading")),1)])):u.value&&g.value.length===0?(l(),i("div",bt,[a[9]||(a[9]=M('<div class="no-results-icon" data-v-228b3eec><svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" data-v-228b3eec><circle cx="11" cy="11" r="8" data-v-228b3eec></circle><line x1="21" y1="21" x2="16.65" y2="16.65" data-v-228b3eec></line><line x1="8" y1="11" x2="14" y2="11" data-v-228b3eec></line></svg></div>',1)),t("h3",_t,o(e.$t("search.noResults")),1),t("p",ft,o(e.$t("search.noResultsDescription")),1)])):g.value.length>0?(l(),i("div",{key:2,class:I(["results-container",[`view-${$.value}`]])},[(l(!0),i(V,null,x(g.value,s=>(l(),J(be,{key:s.id,item:s,compact:$.value==="list"},null,8,["item","compact"]))),128))],2)):(l(),i("div",gt,[...a[10]||(a[10]=[M('<div class="initial-icon" data-v-228b3eec><svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" data-v-228b3eec><circle cx="11" cy="11" r="8" data-v-228b3eec></circle><line x1="21" y1="21" x2="16.65" y2="16.65" data-v-228b3eec></line></svg></div><p class="initial-text" data-v-228b3eec>أدخل كلمات البحث للعثور على المحتوى</p>',2)])])),L.value>1?(l(),J(fe,{key:4,"current-page":y.value,"total-pages":L.value,onPageChange:ae},null,8,["current-page","total-pages"])):h("",!0)])])])])]))}},jt=he(yt,[["__scopeId","data-v-228b3eec"]]);export{jt as default};
