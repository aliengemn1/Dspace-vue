import{r,c as H,o as Ae,J as Me,w as qe,k as i,m as t,j as te,t as o,p as U,K as $,L as J,F,u as q,A as se,M as K,n as O,B as le,x as W,z as Be,l as n,N as oe}from"./vue-vendor-yx-9Zx-6.js";import{u as Re}from"./i18n-CZH2hkgn.js";import{_ as je,S as De}from"./index-C9hMAXH0.js";import{I as Te}from"./ItemCard-DZaC_vic.js";import{B as Ue}from"./Breadcrumb-Dz3t5IP6.js";import{P as Oe}from"./Pagination-BpceT2iO.js";import{a as ne,u as C}from"./dspace-CvDgOV_T.js";import"./utils-B9ygI19o.js";const Ee={class:"search-view"},Pe={class:"breadcrumb-section"},Le={class:"container"},Ie={class:"search-header"},Ne={class:"container"},We={class:"page-title"},ze={class:"search-mode-toggle"},Ge={key:0,class:"simple-search-wrapper"},Ze={class:"search-box-wrapper"},He={class:"search-mode-options"},Je={class:"search-mode-label"},Ke={class:"search-mode-option"},Xe={class:"search-mode-option"},Ye={class:"search-mode-option"},Qe={key:1,class:"advanced-search-form"},ea={class:"advanced-rows"},aa={key:0,class:"row-operator"},ta=["onUpdate:modelValue"],sa=["value"],la={key:1,class:"row-operator-placeholder"},oa={class:"row-field"},na=["onUpdate:modelValue"],ia=["value"],da={class:"row-value"},ra=["onUpdate:modelValue","placeholder"],ca=["onClick","aria-label"],ua={key:3,class:"row-remove-placeholder"},va={class:"date-range-section"},ha={class:"section-title"},pa={class:"date-range-inputs"},fa={class:"form-group"},ma={class:"form-label"},ba={class:"form-group"},ya={class:"form-label"},ga={class:"advanced-search-actions"},_a={class:"search-content"},wa={class:"container"},ka={class:"search-layout"},$a={class:"filters-header"},Fa={class:"filters-title"},Ca={key:0,class:"filter-group"},Sa={class:"filter-group-title"},Va={class:"filter-options"},xa=["checked","onChange"],Aa={class:"filter-label"},Ma={class:"filter-count"},qa={key:0,class:"facets-loading"},Ba={key:1,class:"no-facets"},Ra={class:"results-area"},ja={class:"results-header"},Da={class:"results-info"},Ta={key:0,class:"results-count"},Ua={class:"results-controls"},Oa={class:"view-toggle"},Ea=["aria-label"],Pa=["aria-label"],La={class:"sort-wrapper"},Ia={for:"sort-select",class:"sort-label"},Na=["value"],Wa=["value"],za={key:0,class:"results-loading"},Ga={key:1,class:"no-results"},Za={class:"no-results-title"},Ha={class:"no-results-description"},Ja={key:3,class:"search-initial"},ie=12,Ka={__name:"SearchView",setup(Xa){const p=Me(),P=Be(),{t:S,locale:de}=Re(),c=r(""),z=r(!1),L=r(!1),V=r([]),B=r(0),w=r(1),R=r(!1),k=r("contains"),x=r([{field:"keyword",value:"",operator:"AND"}]),g=r({keyword:"",title:"",author:"",subject:"",dateFrom:"",dateTo:"",abstract:"",identifier:""}),X=[{id:"keyword",field:"*",label:"search.advancedFields.keyword"},{id:"title",field:"dc.title",label:"search.advancedFields.title"},{id:"author",field:"dc.contributor.author",label:"search.advancedFields.author"},{id:"subject",field:"dc.subject",label:"search.advancedFields.subject"},{id:"abstract",field:"dc.description.abstract",label:"search.advancedFields.abstract"},{id:"identifier",field:"dc.identifier",label:"search.advancedFields.identifier"}],re=["AND","OR","NOT"],ce=[{value:"relevance",label:S("search.relevance")},{value:"date_desc",label:S("search.dateNewest")},{value:"date_asc",label:S("search.dateOldest")},{value:"title_asc",label:S("search.titleAZ")},{value:"title_desc",label:S("search.titleZA")}],G=r("relevance"),Z=r(!1),E=r("grid"),I=r("general"),b=r("*"),y=r({}),j=r({}),ue={author:{ar:"المؤلف",en:"Author"},subject:{ar:"الموضوع",en:"Subject"},dateIssued:{ar:"تاريخ النشر",en:"Date Issued"},itemtype:{ar:"نوع المادة",en:"Item Type"},has_content_in_original_bundle:{ar:"يحتوي على ملفات",en:"Has Files"},entityType:{ar:"نوع الكيان",en:"Entity Type"}},Y=H(()=>Math.ceil(B.value/ie)),ve=H(()=>[{label:S("nav.home"),path:"/"},{label:S("nav.search"),path:"/search"}]);function he(e,a,s){c.value=e,a&&(I.value=a),s&&(b.value=s),w.value=1,_(),P.push({query:{q:e,page:1,category:I.value,field:b.value}})}function pe(e,a){I.value=e,a&&(b.value=a),c.value&&(_(),P.push({query:{...p.query,category:e,field:b.value}}))}function Q(e){E.value=e}function fe(e){return{relevance:"score,DESC",date_desc:"dc.date.issued,DESC",date_asc:"dc.date.issued,ASC",title_asc:"dc.title,ASC",title_desc:"dc.title,DESC"}[e]||"score,DESC"}function ee(e){const a=ue[e];return a?de.value==="ar"?a.ar:a.en:e.charAt(0).toUpperCase()+e.slice(1)}async function me(){var e,a,s,d,l;L.value=!0;try{const u=await ne.getFacets();if(console.log("Facets response:",u),(e=u._embedded)!=null&&e.facets){const f={};for(const m of u._embedded.facets){let A=[];if((a=m._embedded)!=null&&a.values)A=m._embedded.values;else if((d=(s=m._links)==null?void 0:s.self)!=null&&d.href)try{const M=await(await fetch(m._links.self.href,{credentials:"include"})).json();(l=M._embedded)!=null&&l.values&&(A=M._embedded.values)}catch(h){console.warn(`Could not load facet values for ${m.name}:`,h)}A.length>0&&(f[m.name]={name:m.name,label:ee(m.name),values:A.map(h=>({label:h.label||h.value,value:h.value,count:h.count||0}))})}j.value=f,console.log("Processed facets:",j.value)}}catch(u){console.error("Failed to load facets:",u)}finally{L.value=!1}}function be(e){const a=e.metadata||{};return{id:e.uuid||e.id,title:C.getMetadataValue(a,"dc.title")||"بدون عنوان",author:C.getMetadataValue(a,"dc.contributor.author")||C.getMetadataValue(a,"dc.creator")||"غير معروف",date:C.getMetadataValue(a,"dc.date.issued")||"",type:C.getMetadataValue(a,"dc.type")||"غير محدد",collection:C.getMetadataValue(a,"dc.relation.ispartof")||"",thumbnail:C.getThumbnailUrl(e),abstract:C.getMetadataValue(a,"dc.description.abstract")}}function ye(e,a){if(!e)return e;switch(a){case"startsWith":return`${e}*`;case"exact":return`"${e}"`;case"contains":default:return`*${e}*`}}async function _(){var a,s,d,l,u,f,m,A;if(!c.value.trim()){V.value=[],B.value=0;return}z.value=!0;try{const h={};Object.entries(y.value).forEach(([T,v])=>{Array.isArray(v)&&v.length>0&&(h[T]=v)});let M=c.value;!R.value&&k.value!=="contains"&&(M=ye(c.value,k.value)),b.value&&b.value!=="*"&&(M=`${b.value}:${M}`);const D=await ne.searchWithFacets(M,h,{page:w.value-1,size:ie,sort:fe(G.value)});if((d=(s=(a=D._embedded)==null?void 0:a.searchResult)==null?void 0:s._embedded)!=null&&d.objects?V.value=D._embedded.searchResult._embedded.objects.map(T=>{var v;return(v=T._embedded)==null?void 0:v.indexableObject}).filter(Boolean).map(be):V.value=[],B.value=((f=(u=(l=D._embedded)==null?void 0:l.searchResult)==null?void 0:u.page)==null?void 0:f.totalElements)||((m=D.page)==null?void 0:m.totalElements)||0,(A=D._embedded)!=null&&A.facets){const T={};D._embedded.facets.forEach(v=>{var ae;(ae=v._embedded)!=null&&ae.values&&v._embedded.values.length>0&&(T[v.name]={name:v.name,label:ee(v.name),values:v._embedded.values.map(N=>({label:N.label||N.value,value:N.value,count:N.count||0}))})}),j.value=T,console.log("Updated facets from search:",j.value)}}catch(h){console.error("Search failed:",h),V.value=[],B.value=0}finally{z.value=!1}}function ge(e){w.value=e,P.push({query:{...p.query,page:e}}),_()}function _e(e){G.value=e.target.value,w.value=1,_()}function we(e,a){y.value[e]||(y.value[e]=[]);const s=y.value[e].indexOf(a);s>-1?y.value[e].splice(s,1):y.value[e].push(a),w.value=1,console.log("Filter toggled:",e,a,y.value),_()}function ke(){y.value={},_()}function $e(){g.value={keyword:"",title:"",author:"",subject:"",dateFrom:"",dateTo:"",abstract:"",identifier:""},x.value=[{field:"keyword",value:"",operator:"AND"}]}function Fe(){x.value.push({field:"keyword",value:"",operator:"AND"})}function Ce(e){x.value.length>1&&x.value.splice(e,1)}function Se(e){const a=X.find(s=>s.id===e);return a?a.field:"*"}function Ve(){const e=x.value.filter(s=>s.value.trim());if(e.length===0)return;let a="";if(e.forEach((s,d)=>{const l=Se(s.field),u=s.value.trim();let f="";l==="*"?f=u:f=`${l}:${u}`,d===0?a=f:a=`${a} ${s.operator} ${f}`}),g.value.dateFrom||g.value.dateTo){const s=g.value.dateFrom||"*",d=g.value.dateTo||"*",l=`dc.date.issued:[${s} TO ${d}]`;a=a?`${a} AND ${l}`:l}c.value=a,b.value="*",w.value=1,_(),P.push({query:{q:c.value,page:1,advanced:"true"}})}const xe=H(()=>Object.values(y.value).some(e=>Array.isArray(e)&&e.length>0));return Ae(async()=>{await me(),p.query.q?c.value=p.query.q:c.value="*",p.query.category&&(I.value=p.query.category),p.query.field&&(b.value=p.query.field),p.query.page&&(w.value=parseInt(p.query.page)),_()}),qe(()=>p.query,e=>{e.q!==c.value&&(c.value=e.q||"*"),e.field&&(b.value=e.field),_()}),(e,a)=>(n(),i("div",Ee,[t("div",Pe,[t("div",Le,[te(Ue,{items:ve.value},null,8,["items"])])]),t("div",Ie,[t("div",Ne,[t("h1",We,o(e.$t("search.results")),1),t("div",ze,[t("button",{class:U(["mode-btn",{active:!R.value}]),onClick:a[0]||(a[0]=s=>R.value=!1)},o(e.$t("search.simpleSearch")),3),t("button",{class:U(["mode-btn",{active:R.value}]),onClick:a[1]||(a[1]=s=>R.value=!0)},o(e.$t("search.advancedSearch")),3)]),R.value?(n(),i("div",Qe,[t("div",ea,[(n(!0),i(F,null,q(x.value,(s,d)=>(n(),i("div",{key:d,class:"advanced-row"},[d>0?(n(),i("div",aa,[$(t("select",{"onUpdate:modelValue":l=>s.operator=l,class:"operator-select"},[(n(),i(F,null,q(re,l=>t("option",{key:l,value:l},o(e.$t(`search.advancedFields.${l.toLowerCase()}`)),9,sa)),64))],8,ta),[[oe,s.operator]])])):(n(),i("div",la)),t("div",oa,[$(t("select",{"onUpdate:modelValue":l=>s.field=l,class:"field-select"},[(n(),i(F,null,q(X,l=>t("option",{key:l.id,value:l.id},o(e.$t(l.label)),9,ia)),64))],8,na),[[oe,s.field]])]),t("div",da,[$(t("input",{"onUpdate:modelValue":l=>s.value=l,type:"text",class:"form-input",placeholder:e.$t("search.advancedFields.anyField")},null,8,ra),[[K,s.value]])]),x.value.length>1?(n(),i("button",{key:2,type:"button",class:"row-remove-btn",onClick:l=>Ce(d),"aria-label":e.$t("search.advancedFields.removeField")},[...a[11]||(a[11]=[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),t("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])],8,ca)):(n(),i("div",ua))]))),128)),t("button",{type:"button",class:"add-row-btn",onClick:Fe},[a[12]||(a[12]=t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),t("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1)),se(" "+o(e.$t("search.advancedFields.addField")),1)])]),t("div",va,[t("h4",ha,o(e.$t("search.filterBy.date")),1),t("div",pa,[t("div",fa,[t("label",ma,o(e.$t("search.advancedFields.dateFrom")),1),$(t("input",{"onUpdate:modelValue":a[6]||(a[6]=s=>g.value.dateFrom=s),type:"date",class:"form-input"},null,512),[[K,g.value.dateFrom]])]),t("div",ba,[t("label",ya,o(e.$t("search.advancedFields.dateTo")),1),$(t("input",{"onUpdate:modelValue":a[7]||(a[7]=s=>g.value.dateTo=s),type:"date",class:"form-input"},null,512),[[K,g.value.dateTo]])])])]),t("div",ga,[t("button",{type:"button",class:"btn btn-secondary",onClick:$e},o(e.$t("search.advancedFields.clearButton")),1),t("button",{type:"button",class:"btn btn-primary",onClick:Ve},o(e.$t("search.advancedFields.searchButton")),1)])])):(n(),i("div",Ge,[t("div",Ze,[te(De,{modelValue:c.value,"onUpdate:modelValue":a[2]||(a[2]=s=>c.value=s),placeholder:e.$t("search.placeholder"),"show-advanced":!1,"show-categories":!0,onSearch:he,onCategoryChange:pe},null,8,["modelValue","placeholder"])]),t("div",He,[t("span",Je,o(e.$t("search.searchMode.label"))+":",1),t("label",Ke,[$(t("input",{type:"radio","onUpdate:modelValue":a[3]||(a[3]=s=>k.value=s),value:"contains"},null,512),[[J,k.value]]),t("span",null,o(e.$t("search.searchMode.contains")),1)]),t("label",Xe,[$(t("input",{type:"radio","onUpdate:modelValue":a[4]||(a[4]=s=>k.value=s),value:"startsWith"},null,512),[[J,k.value]]),t("span",null,o(e.$t("search.searchMode.startsWith")),1)]),t("label",Ye,[$(t("input",{type:"radio","onUpdate:modelValue":a[5]||(a[5]=s=>k.value=s),value:"exact"},null,512),[[J,k.value]]),t("span",null,o(e.$t("search.searchMode.exact")),1)])])]))])]),t("div",_a,[t("div",wa,[t("div",ka,[t("aside",{class:U(["filters-sidebar",{"is-open":Z.value}])},[t("div",$a,[t("h2",Fa,o(e.$t("search.filters")),1),xe.value?(n(),i("button",{key:0,class:"clear-filters-btn",onClick:ke},o(e.$t("common.clear")),1)):O("",!0)]),(n(!0),i(F,null,q(j.value,(s,d)=>(n(),i(F,{key:d},[s.values&&s.values.length>0?(n(),i("div",Ca,[t("h3",Sa,o(s.label),1),t("div",Va,[(n(!0),i(F,null,q(s.values.slice(0,10),l=>{var u;return n(),i("label",{key:l.value,class:"filter-option"},[t("input",{type:"checkbox",checked:(u=y.value[d])==null?void 0:u.includes(l.value),onChange:f=>we(d,l.value)},null,40,xa),t("span",Aa,o(l.label),1),t("span",Ma,"("+o(l.count)+")",1)])}),128))])])):O("",!0)],64))),128)),L.value?(n(),i("div",qa,[a[13]||(a[13]=t("div",{class:"spinner-small"},null,-1)),t("span",null,o(e.$t("common.loading")),1)])):O("",!0),!L.value&&Object.keys(j.value).length===0?(n(),i("div",Ba,[t("p",null,o(e.$t("search.noFiltersAvailable")||"ابحث للحصول على خيارات التصفية"),1)])):O("",!0)],2),t("main",Ra,[t("div",ja,[t("div",Da,[t("button",{class:"filter-toggle hide-lg-up",onClick:a[8]||(a[8]=s=>Z.value=!Z.value)},[a[14]||(a[14]=t("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"})],-1)),se(" "+o(e.$t("search.filters")),1)]),B.value>0?(n(),i("span",Ta,o(e.$t("search.resultsCount",{count:B.value})),1)):O("",!0)]),t("div",Ua,[t("div",Oa,[t("button",{class:U(["view-btn",{active:E.value==="grid"}]),onClick:a[9]||(a[9]=s=>Q("grid")),"aria-label":e.$t("search.viewGrid")||"Grid view"},[...a[15]||(a[15]=[W('<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-475a77aa><rect x="3" y="3" width="7" height="7" data-v-475a77aa></rect><rect x="14" y="3" width="7" height="7" data-v-475a77aa></rect><rect x="14" y="14" width="7" height="7" data-v-475a77aa></rect><rect x="3" y="14" width="7" height="7" data-v-475a77aa></rect></svg>',1)])],10,Ea),t("button",{class:U(["view-btn",{active:E.value==="list"}]),onClick:a[10]||(a[10]=s=>Q("list")),"aria-label":e.$t("search.viewList")||"List view"},[...a[16]||(a[16]=[W('<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-475a77aa><line x1="8" y1="6" x2="21" y2="6" data-v-475a77aa></line><line x1="8" y1="12" x2="21" y2="12" data-v-475a77aa></line><line x1="8" y1="18" x2="21" y2="18" data-v-475a77aa></line><line x1="3" y1="6" x2="3.01" y2="6" data-v-475a77aa></line><line x1="3" y1="12" x2="3.01" y2="12" data-v-475a77aa></line><line x1="3" y1="18" x2="3.01" y2="18" data-v-475a77aa></line></svg>',1)])],10,Pa)]),t("div",La,[t("label",Ia,o(e.$t("search.sortBy"))+":",1),t("select",{id:"sort-select",class:"sort-select",value:G.value,onChange:_e},[(n(),i(F,null,q(ce,s=>t("option",{key:s.value,value:s.value},o(s.label),9,Wa)),64))],40,Na)])])]),z.value?(n(),i("div",za,[a[17]||(a[17]=t("div",{class:"spinner"},null,-1)),t("span",null,o(e.$t("common.loading")),1)])):c.value&&V.value.length===0?(n(),i("div",Ga,[a[18]||(a[18]=W('<div class="no-results-icon" data-v-475a77aa><svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" data-v-475a77aa><circle cx="11" cy="11" r="8" data-v-475a77aa></circle><line x1="21" y1="21" x2="16.65" y2="16.65" data-v-475a77aa></line><line x1="8" y1="11" x2="14" y2="11" data-v-475a77aa></line></svg></div>',1)),t("h3",Za,o(e.$t("search.noResults")),1),t("p",Ha,o(e.$t("search.noResultsDescription")),1)])):V.value.length>0?(n(),i("div",{key:2,class:U(["results-container",[`view-${E.value}`]])},[(n(!0),i(F,null,q(V.value,s=>(n(),le(Te,{key:s.id,item:s,compact:E.value==="list"},null,8,["item","compact"]))),128))],2)):(n(),i("div",Ja,[...a[19]||(a[19]=[W('<div class="initial-icon" data-v-475a77aa><svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" data-v-475a77aa><circle cx="11" cy="11" r="8" data-v-475a77aa></circle><line x1="21" y1="21" x2="16.65" y2="16.65" data-v-475a77aa></line></svg></div><p class="initial-text" data-v-475a77aa>أدخل كلمات البحث للعثور على المحتوى</p>',2)])])),Y.value>1?(n(),le(Oe,{key:4,"current-page":w.value,"total-pages":Y.value,onPageChange:ge},null,8,["current-page","total-pages"])):O("",!0)])])])])]))}},nt=je(Ka,[["__scopeId","data-v-475a77aa"]]);export{nt as default};
