import{r as m,c as k,o as G,b as Y,k as n,l as i,m as e,t as l,K as b,x as K,n as $,L as P,M as H,I as Z,p as O,j as ee,F as C,u as F,A as I,B as te,N as ae,J as le}from"./vue-vendor-CZlwpbXF.js";import{u as J}from"./i18n-CCTaJ8OG.js";import{B as se}from"./Breadcrumb-BCSQGoOZ.js";import{_ as Q}from"./index-BAXmnS_s.js";import{e as A,u,i as D}from"./dspace-oOyns0sE.js";import"./utils-B9ygI19o.js";const ie={class:"pdf-toolbar"},ne={class:"toolbar-left"},oe={class:"pdf-filename"},re={class:"toolbar-center"},de={class:"zoom-controls"},ue=["disabled","title"],ce={class:"zoom-value"},ve=["disabled","title"],me={class:"toolbar-right"},pe=["title"],fe={key:0,width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},he={key:1,width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},be=["title"],ye=["title"],ge={key:0,class:"pdf-loading"},we={key:1,class:"pdf-error"},ke=["src","title"],_e={__name:"PdfViewer",props:{src:{type:String,required:!0},fileName:{type:String,default:"document.pdf"}},emits:["close","download"],setup(E,{emit:L}){const{t:o}=J(),d=E,w=L,V=m(null),_=m(!0),c=m(!1),p=m(1);m(1);const y=m(100),v=m(!1),f=[50,75,100,125,150,200],N=k(()=>`${d.src}#page=${p.value}`);function R(){_.value=!1}function U(){_.value=!1,c.value=!0}function M(){const h=f.indexOf(y.value);h<f.length-1&&(y.value=f[h+1])}function B(){const h=f.indexOf(y.value);h>0&&(y.value=f[h-1])}function S(){const h=document.querySelector(".pdf-viewer-container");v.value?document.exitFullscreen&&document.exitFullscreen():h.requestFullscreen&&h.requestFullscreen()}function z(){v.value=!!document.fullscreenElement}function j(){w("download")}function T(){w("close")}return G(()=>{document.addEventListener("fullscreenchange",z)}),Y(()=>{document.removeEventListener("fullscreenchange",z)}),(h,r)=>(i(),n("div",{class:O(["pdf-viewer-container",{"is-fullscreen":v.value}])},[e("div",ie,[e("div",ne,[e("span",oe,l(E.fileName),1)]),e("div",re,[e("div",de,[e("button",{type:"button",class:"toolbar-btn",onClick:B,disabled:y.value<=f[0],title:b(o)("item.viewer.zoomOut")},[...r[0]||(r[0]=[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"11",cy:"11",r:"8"}),e("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"}),e("line",{x1:"8",y1:"11",x2:"14",y2:"11"})],-1)])],8,ue),e("span",ce,l(y.value)+"%",1),e("button",{type:"button",class:"toolbar-btn",onClick:M,disabled:y.value>=f[f.length-1],title:b(o)("item.viewer.zoomIn")},[...r[1]||(r[1]=[K('<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-8a50ef58><circle cx="11" cy="11" r="8" data-v-8a50ef58></circle><line x1="21" y1="21" x2="16.65" y2="16.65" data-v-8a50ef58></line><line x1="11" y1="8" x2="11" y2="14" data-v-8a50ef58></line><line x1="8" y1="11" x2="14" y2="11" data-v-8a50ef58></line></svg>',1)])],8,ve)])]),e("div",me,[e("button",{type:"button",class:"toolbar-btn",onClick:S,title:v.value?b(o)("item.viewer.exitFullscreen"):b(o)("item.viewer.fullscreen")},[v.value?(i(),n("svg",he,[...r[3]||(r[3]=[e("polyline",{points:"4 14 10 14 10 20"},null,-1),e("polyline",{points:"20 10 14 10 14 4"},null,-1),e("line",{x1:"14",y1:"10",x2:"21",y2:"3"},null,-1),e("line",{x1:"3",y1:"21",x2:"10",y2:"14"},null,-1)])])):(i(),n("svg",fe,[...r[2]||(r[2]=[e("polyline",{points:"15 3 21 3 21 9"},null,-1),e("polyline",{points:"9 21 3 21 3 15"},null,-1),e("line",{x1:"21",y1:"3",x2:"14",y2:"10"},null,-1),e("line",{x1:"3",y1:"21",x2:"10",y2:"14"},null,-1)])]))],8,pe),e("button",{type:"button",class:"toolbar-btn",onClick:j,title:b(o)("item.download")},[...r[4]||(r[4]=[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e("polyline",{points:"7 10 12 15 17 10"}),e("line",{x1:"12",y1:"15",x2:"12",y2:"3"})],-1)])],8,be),e("button",{type:"button",class:"toolbar-btn toolbar-btn-close",onClick:T,title:b(o)("common.close")},[...r[5]||(r[5]=[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])],8,ye)])]),e("div",{class:"pdf-content",style:Z({transform:`scale(${y.value/100})`})},[_.value?(i(),n("div",ge,[r[6]||(r[6]=e("div",{class:"spinner"},null,-1)),e("p",null,l(b(o)("common.loading")),1)])):$("",!0),c.value?(i(),n("div",we,[r[7]||(r[7]=e("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})],-1)),e("p",null,l(b(o)("item.viewer.loadError")),1),e("button",{class:"btn btn-primary",onClick:j},l(b(o)("item.download")),1)])):$("",!0),P(e("iframe",{ref_key:"iframeRef",ref:V,src:N.value,class:"pdf-iframe",onLoad:R,onError:U,title:E.fileName,allowfullscreen:""},null,40,ke),[[H,!c.value]])],4)],2))}},xe=Q(_e,[["__scopeId","data-v-8a50ef58"]]),$e={class:"item-view"},Ce={class:"breadcrumb-section"},Ve={class:"container"},Me={key:0,class:"loading-container"},Be={key:1,class:"error-container"},ze={class:"alert alert-error"},Fe={key:2,class:"item-content"},Ie={class:"container"},Pe={class:"item-layout"},Ee={class:"item-main"},Le={class:"item-header card"},Ne={class:"item-title"},Se={class:"item-authors"},je={key:0,class:"item-abstract"},Te={class:"item-tabs card"},He={class:"tabs"},Oe={class:"tabs-nav"},Re={class:"tabs-content"},Ue={class:"tab-pane preview-pane"},qe={key:0,class:"pdf-viewer-container"},Ae={key:0,class:"pdf-selector"},De=["value"],Ge={key:2,class:"no-pdf-selected"},Ke={key:1,class:"no-pdf-available"},Je={class:"tab-pane"},Qe={class:"metadata-table"},We={class:"tab-pane"},Xe={key:0,class:"empty-files"},Ye={key:1,class:"files-list"},Ze={class:"file-info"},et={class:"file-name"},tt={class:"file-size"},at={class:"file-actions"},lt=["onClick"],st=["onClick"],it={class:"item-sidebar"},nt={class:"card sidebar-card"},ot={class:"sidebar-title"},rt={class:"share-buttons"},dt={class:"card sidebar-card"},ut={class:"sidebar-title"},ct={class:"citation-box"},vt={class:"citation-text"},mt={__name:"ItemView",setup(E){const L=le(),{t:o}=J(),d=m(null),w=m([]),V=m(!0),_=m(null),c=m("preview"),p=m(null),y=m(!1),v=k(()=>w.value.filter(t=>t.mimeType==="application/pdf")),f=k(()=>v.value.length>0?v.value[0]:null),N=k(()=>p.value?A.getContentUrl(p.value.id):null),R=k(()=>{var t;return[{label:o("nav.home"),path:"/"},{label:o("nav.browse"),path:"/browse"},{label:((t=d.value)==null?void 0:t.title)||o("item.title"),path:null}]}),U=k(()=>{var a;if(!((a=d.value)!=null&&a.metadata))return[];const t=d.value.metadata;return[{key:"title",label:o("item.fields.title"),value:u.getMetadataValue(t,"dc.title")},{key:"author",label:o("item.fields.author"),value:u.getMetadataValue(t,"dc.contributor.author",!0)},{key:"date",label:o("item.fields.date"),value:u.getMetadataValue(t,"dc.date.issued")},{key:"type",label:o("item.fields.type"),value:u.getMetadataValue(t,"dc.type")},{key:"subject",label:o("item.fields.subject"),value:u.getMetadataValue(t,"dc.subject",!0)},{key:"abstract",label:o("item.fields.abstract"),value:u.getMetadataValue(t,"dc.description.abstract")},{key:"language",label:o("item.fields.language"),value:u.getMetadataValue(t,"dc.language.iso")},{key:"publisher",label:o("item.fields.publisher"),value:u.getMetadataValue(t,"dc.publisher")},{key:"identifier",label:o("item.fields.identifier"),value:u.getMetadataValue(t,"dc.identifier.uri")},{key:"rights",label:o("item.fields.rights"),value:u.getMetadataValue(t,"dc.rights")}].filter(g=>g.value)}),M=k(()=>{var t;return(t=d.value)!=null&&t.metadata&&u.getMetadataValue(d.value.metadata,"dc.title")||""}),B=k(()=>{var t;return(t=d.value)!=null&&t.metadata?u.getMetadataValue(d.value.metadata,"dc.contributor.author",!0)||[]:[]}),S=k(()=>{var t;return(t=d.value)!=null&&t.metadata&&u.getMetadataValue(d.value.metadata,"dc.description.abstract")||""});async function z(){var t,a;V.value=!0,_.value=null;try{const g=L.params.id;d.value=await D.getById(g);const s=await D.getBundles(g);if((t=s._embedded)!=null&&t.bundles){for(const x of s._embedded.bundles)if(x.name==="ORIGINAL"){const q=await A.getByBundle(x.id);w.value=((a=q._embedded)==null?void 0:a.bitstreams)||[]}}}catch(g){_.value=g.message||"فشل تحميل بيانات العنصر",d.value={id:L.params.id,metadata:{"dc.title":[{value:"دراسة تحليلية لأثر التحول الرقمي على الخدمات المكتبية"}],"dc.contributor.author":[{value:"محمد عبدالله الشمري"}],"dc.date.issued":[{value:"2024"}],"dc.type":[{value:"رسالة ماجستير"}],"dc.subject":[{value:"المكتبات"},{value:"التحول الرقمي"}],"dc.description.abstract":[{value:"تهدف هذه الدراسة إلى تحليل أثر التحول الرقمي على الخدمات المكتبية في المملكة العربية السعودية، من خلال دراسة حالات متعددة للمكتبات الأكاديمية والعامة."}],"dc.language.iso":[{value:"العربية"}],"dc.publisher":[{value:"جامعة الملك سعود"}]}},w.value=[{id:"1",name:"الرسالة.pdf",sizeBytes:254e4,mimeType:"application/pdf"}]}finally{V.value=!1,v.value.length>0?p.value=v.value[0]:c.value="metadata"}}function j(t){if(t===0)return"0 Bytes";const a=1024,g=["Bytes","KB","MB","GB"],s=Math.floor(Math.log(t)/Math.log(a));return parseFloat((t/Math.pow(a,s)).toFixed(2))+" "+g[s]}function T(t){const a=A.getContentUrl(t.id);window.open(a,"_blank")}function h(t){navigator.clipboard.writeText(t)}function r(t){p.value=t,y.value=!0,c.value="preview"}function W(){y.value=!1}function X(){p.value&&T(p.value)}return G(()=>{z()}),(t,a)=>{var g;return i(),n("div",$e,[e("div",Ce,[e("div",Ve,[ee(se,{items:R.value},null,8,["items"])])]),V.value?(i(),n("div",Me,[a[8]||(a[8]=e("div",{class:"spinner spinner-lg"},null,-1)),e("p",null,l(t.$t("common.loading")),1)])):_.value&&!d.value?(i(),n("div",Be,[e("div",ze,[e("p",null,l(_.value),1),e("button",{class:"btn btn-primary",onClick:z},l(t.$t("common.retry")),1)])])):d.value?(i(),n("div",Fe,[e("div",Ie,[e("div",Pe,[e("main",Ee,[e("div",Le,[e("h1",Ne,l(M.value),1),e("div",Se,[(i(!0),n(C,null,F(B.value,(s,x)=>(i(),n("span",{key:x,class:"author-tag"},l(s),1))),128))]),S.value?(i(),n("p",je,l(S.value),1)):$("",!0)]),e("div",Te,[e("div",He,[e("div",Oe,[v.value.length>0?(i(),n("button",{key:0,class:O(["tab-item",{active:c.value==="preview"}]),onClick:a[0]||(a[0]=s=>{c.value="preview",p.value||r(f.value)})},[a[9]||(a[9]=K('<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-aed86e68><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" data-v-aed86e68></path><polyline points="14 2 14 8 20 8" data-v-aed86e68></polyline><line x1="16" y1="13" x2="8" y2="13" data-v-aed86e68></line><line x1="16" y1="17" x2="8" y2="17" data-v-aed86e68></line></svg>',1)),I(" "+l(t.$t("item.preview")),1)],2)):$("",!0),e("button",{class:O(["tab-item",{active:c.value==="metadata"}]),onClick:a[1]||(a[1]=s=>c.value="metadata")},l(t.$t("item.metadata")),3),e("button",{class:O(["tab-item",{active:c.value==="files"}]),onClick:a[2]||(a[2]=s=>c.value="files")},l(t.$t("item.files"))+" ("+l(w.value.length)+") ",3)]),e("div",Re,[P(e("div",Ue,[v.value.length>0?(i(),n("div",qe,[v.value.length>1?(i(),n("div",Ae,[e("label",null,l(t.$t("item.files"))+":",1),P(e("select",{"onUpdate:modelValue":a[3]||(a[3]=s=>p.value=s),onChange:a[4]||(a[4]=s=>r(p.value))},[(i(!0),n(C,null,F(v.value,s=>(i(),n("option",{key:s.id,value:s},l(s.name),9,De))),128))],544),[[ae,p.value]])])):$("",!0),N.value?(i(),te(xe,{key:1,src:N.value,"file-name":((g=p.value)==null?void 0:g.name)||"document.pdf",onClose:W,onDownload:X},null,8,["src","file-name"])):(i(),n("div",Ge,[e("p",null,l(t.$t("item.openPdf")),1),f.value?(i(),n("button",{key:0,class:"btn btn-primary",onClick:a[5]||(a[5]=s=>r(f.value))},l(t.$t("item.openPdf")),1)):$("",!0)]))])):(i(),n("div",Ke,[a[10]||(a[10]=e("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[e("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e("polyline",{points:"14 2 14 8 20 8"})],-1)),e("p",null,l(t.$t("item.viewer.loadError")),1)]))],512),[[H,c.value==="preview"]]),P(e("div",Je,[e("table",Qe,[e("tbody",null,[(i(!0),n(C,null,F(U.value,s=>(i(),n("tr",{key:s.key},[e("th",null,l(s.label),1),e("td",null,[Array.isArray(s.value)?(i(!0),n(C,{key:0},F(s.value,(x,q)=>(i(),n("span",{key:q,class:"metadata-tag"},l(x),1))),128)):(i(),n(C,{key:1},[I(l(s.value),1)],64))])]))),128))])])],512),[[H,c.value==="metadata"]]),P(e("div",We,[w.value.length===0?(i(),n("div",Xe,[...a[11]||(a[11]=[e("p",null,"لا توجد ملفات متاحة",-1)])])):(i(),n("div",Ye,[(i(!0),n(C,null,F(w.value,s=>(i(),n("div",{key:s.id,class:"file-item"},[a[14]||(a[14]=e("div",{class:"file-icon"},[e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e("polyline",{points:"14 2 14 8 20 8"})])],-1)),e("div",Ze,[e("span",et,l(s.name),1),e("span",tt,l(j(s.sizeBytes)),1)]),e("div",at,[s.mimeType==="application/pdf"?(i(),n("button",{key:0,class:"btn btn-secondary btn-sm",onClick:x=>r(s)},[a[12]||(a[12]=e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),e("circle",{cx:"12",cy:"12",r:"3"})],-1)),I(" "+l(t.$t("item.preview")),1)],8,lt)):$("",!0),e("button",{class:"btn btn-primary btn-sm",onClick:x=>T(s)},[a[13]||(a[13]=e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e("polyline",{points:"7 10 12 15 17 10"}),e("line",{x1:"12",y1:"15",x2:"12",y2:"3"})],-1)),I(" "+l(t.$t("item.download")),1)],8,st)])]))),128))]))],512),[[H,c.value==="files"]])])])])]),e("aside",it,[e("div",nt,[e("h3",ot,l(t.$t("item.share")),1),e("div",rt,[e("button",{class:"share-btn",onClick:a[6]||(a[6]=s=>h(t.window.location.href))},[...a[15]||(a[15]=[e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),e("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})],-1),I(" نسخ الرابط ",-1)])])])]),e("div",dt,[e("h3",ut,l(t.$t("item.citation")),1),e("div",ct,[e("p",vt,l(B.value.join("، "))+" ("+l(b(u).getMetadataValue(d.value.metadata,"dc.date.issued")||"")+"). "+l(M.value)+". "+l(b(u).getMetadataValue(d.value.metadata,"dc.publisher")||"")+". ",1),e("button",{class:"btn btn-secondary btn-sm",onClick:a[7]||(a[7]=s=>h(`${B.value.join("، ")} (${b(u).getMetadataValue(d.value.metadata,"dc.date.issued")||""}). ${M.value}.`))},l(t.$t("item.copyCitation")),1)])])])])])])):$("",!0)])}}},wt=Q(mt,[["__scopeId","data-v-aed86e68"]]);export{wt as default};
