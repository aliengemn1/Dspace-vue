import{r as h,c as p,J as ne,o as de,k as o,m as e,n as b,j as P,t as l,x as D,I as re,A as c,F as y,u as F,z as ce,l as n,p as ue}from"./vue-vendor-yx-9Zx-6.js";import{u as ve}from"./i18n-CZH2hkgn.js";import{B as me}from"./Breadcrumb-Dz3t5IP6.js";import{M as pe}from"./MediaViewer-S0CEBgFY.js";import{u as w,i as Q,e as Y}from"./dspace-CvDgOV_T.js";import{_ as fe}from"./index-C9hMAXH0.js";import"./ImageSlider-D-pIzYi2.js";import"./utils-B9ygI19o.js";const he={class:"item-full-view"},be={class:"breadcrumb-section"},ge={class:"container"},ye={key:0,class:"loading-container"},we={class:"loading-content"},_e={key:1,class:"error-container"},ke={class:"error-content"},xe={key:2,class:"item-content"},Ce={class:"item-header"},Be={class:"container"},Me={class:"header-content"},Ve={class:"header-top"},Ie={class:"item-title"},Fe={class:"item-meta"},Te={key:0,class:"meta-item"},ze={key:1,class:"meta-item"},je={key:2,class:"meta-item"},$e={class:"main-content"},Se={class:"container"},De={class:"content-layout"},Ne={class:"metadata-sections"},Ae={class:"section-header"},Ee={class:"section-title"},Le={class:"section-content"},Re={class:"metadata-table"},He={key:0,class:"value-list"},Oe=["href"],Xe=["href"],Ge={key:1,class:"value-text"},Ue={key:0,class:"metadata-section file-viewer-section"},We={class:"section-header"},Je={class:"section-title"},Ke={class:"section-content viewer-content"},qe={key:1,class:"metadata-section files-section"},Pe={class:"section-header"},Qe={class:"section-title"},Ye={class:"section-content"},Ze={class:"files-list"},et={class:"file-info"},tt={class:"file-name"},st={class:"file-meta"},it={class:"file-actions"},at=["onClick"],ot=["onClick"],lt={class:"sidebar"},nt={class:"sidebar-card"},dt={class:"actions-list"},rt={class:"sidebar-card"},ct={class:"citation-box"},ut={class:"citation-text"},vt={__name:"ItemFullView",setup(mt){const T=ne(),Z=ce(),{t:k}=ve(),r=h(null),g=h([]),z=h(!0),x=h(null),j=h(!1),C=h(!1),f=h(null),ee=p(()=>{var s;return[{label:k("nav.home"),path:"/"},{label:k("nav.browse"),path:"/browse"},{label:((s=B.value)==null?void 0:s.substring(0,50))+"..."||k("item.title"),path:`/item/${T.params.id}`},{label:k("item.fullDetails")||"التفاصيل الكاملة",path:null}]}),te=p(()=>{var a;if(!((a=r.value)!=null&&a.metadata))return{};const s=r.value.metadata,t={basic:{title:"البيانات الأساسية",fields:[]},authors:{title:"المؤلفون والمساهمون",fields:[]},dates:{title:"التواريخ",fields:[]},identifiers:{title:"المعرفات",fields:[]},description:{title:"الوصف",fields:[]},rights:{title:"الحقوق والوصول",fields:[]},other:{title:"بيانات إضافية",fields:[]}};return i(t.basic.fields,"dc.title","العنوان",s),i(t.basic.fields,"dc.title.alternative","عنوان بديل",s),i(t.basic.fields,"dc.type","النوع",s),i(t.basic.fields,"dc.language.iso","اللغة",s),i(t.basic.fields,"dc.format","التنسيق",s),i(t.basic.fields,"dc.format.extent","الحجم",s),i(t.authors.fields,"dc.contributor.author","المؤلف",s,!0),i(t.authors.fields,"dc.contributor.advisor","المشرف",s,!0),i(t.authors.fields,"dc.contributor.editor","المحرر",s,!0),i(t.authors.fields,"dc.contributor","المساهم",s,!0),i(t.authors.fields,"dc.creator","المنشئ",s,!0),i(t.dates.fields,"dc.date.issued","تاريخ النشر",s),i(t.dates.fields,"dc.date.created","تاريخ الإنشاء",s),i(t.dates.fields,"dc.date.submitted","تاريخ التقديم",s),i(t.dates.fields,"dc.date.accessioned","تاريخ الإيداع",s),i(t.dates.fields,"dc.date.available","تاريخ الإتاحة",s),i(t.identifiers.fields,"dc.identifier.uri","الرابط الدائم",s),i(t.identifiers.fields,"dc.identifier.isbn","ISBN",s),i(t.identifiers.fields,"dc.identifier.issn","ISSN",s),i(t.identifiers.fields,"dc.identifier.doi","DOI",s),i(t.identifiers.fields,"dc.identifier.citation","الاقتباس",s),i(t.identifiers.fields,"dc.identifier","معرف",s),i(t.description.fields,"dc.description.abstract","المستخلص",s),i(t.description.fields,"dc.description","الوصف",s),i(t.description.fields,"dc.subject","الموضوعات",s,!0),i(t.description.fields,"dc.coverage.spatial","التغطية المكانية",s),i(t.description.fields,"dc.coverage.temporal","التغطية الزمنية",s),i(t.rights.fields,"dc.rights","الحقوق",s),i(t.rights.fields,"dc.rights.uri","رابط الحقوق",s),i(t.rights.fields,"dc.rights.holder","صاحب الحقوق",s),i(t.rights.fields,"dc.publisher","الناشر",s),i(t.other.fields,"dc.source","المصدر",s),i(t.other.fields,"dc.relation","العلاقة",s),i(t.other.fields,"dc.relation.ispartof","جزء من",s),i(t.other.fields,"dc.relation.ispartofseries","جزء من سلسلة",s),Object.fromEntries(Object.entries(t).filter(([,u])=>u.fields.length>0))});function i(s,t,a,u,d=!1){const v=w.getMetadataValue(u,t,d);v&&(!Array.isArray(v)||v.length>0)&&s.push({key:t,label:a,value:v,isArray:d})}const B=p(()=>{var s;return(s=r.value)!=null&&s.metadata&&w.getMetadataValue(r.value.metadata,"dc.title")||""}),M=p(()=>{var s;return(s=r.value)!=null&&s.metadata?w.getMetadataValue(r.value.metadata,"dc.contributor.author",!0)||[]:[]}),V=p(()=>{var s;return(s=r.value)!=null&&s.metadata&&w.getMetadataValue(r.value.metadata,"dc.date.issued")||""}),I=p(()=>{var s;return(s=r.value)!=null&&s.metadata&&w.getMetadataValue(r.value.metadata,"dc.publisher")||""}),N=p(()=>{var s;return(s=r.value)!=null&&s.metadata&&w.getMetadataValue(r.value.metadata,"dc.type")||""}),A={"رسالة ماجستير":"#006C35","رسالة دكتوراه":"#1B4D3E","بحث علمي":"#17A2B8",كتاب:"#C8A415",مقال:"#6F42C1",تقرير:"#FD7E14",default:"#757575"},se=p(()=>A[N.value]||A.default);async function E(){var s,t;z.value=!0,x.value=null;try{const a=T.params.id;console.log("Loading full item view:",a);const u=await Q.getById(a);console.log("Item data received:",u),r.value=u;try{const d=await Q.getBundles(a);if(console.log("Bundles response:",d),(s=d._embedded)!=null&&s.bundles){for(const v of d._embedded.bundles)if(v.name==="ORIGINAL"){const $=v.uuid||v.id,S=await Y.getByBundle($);console.log("Bitstreams response:",S),(t=S._embedded)!=null&&t.bitstreams&&(g.value=S._embedded.bitstreams.map(m=>{var G,U,W,J;let _="application/octet-stream";if((W=(U=(G=m.metadata)==null?void 0:G["dc.format.mimetype"])==null?void 0:U[0])!=null&&W.value)_=m.metadata["dc.format.mimetype"][0].value;else if(m.mimeType)_=m.mimeType;else if((J=m.format)!=null&&J.mimetype)_=m.format.mimetype;else if(m.name){const K=m.name.toLowerCase().split(".").pop(),q={pdf:"application/pdf",jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",mp4:"video/mp4",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"};q[K]&&(_=q[K])}return{id:m.uuid||m.id,name:m.name,sizeBytes:m.sizeBytes,mimeType:_}}))}}}catch(d){console.warn("Could not load bundles:",d)}}catch(a){console.error("Error loading item:",a),x.value=a.message||"فشل تحميل بيانات العنصر",r.value=null,g.value=[]}finally{z.value=!1}}function ie(s){if(s===0)return"0 Bytes";const t=1024,a=["Bytes","KB","MB","GB"],u=Math.floor(Math.log(s)/Math.log(t));return parseFloat((s/Math.pow(t,u)).toFixed(2))+" "+a[u]}function L(s){const t=Y.getContentUrl(s.id);window.open(t,"_blank")}function R(s){navigator.clipboard.writeText(s),j.value=!0,setTimeout(()=>j.value=!1,2e3)}function H(){Z.push(`/item/${T.params.id}`)}function ae(s){return["application/pdf","image/jpeg","image/png","image/gif","image/webp","video/mp4","video/webm","audio/mpeg","audio/wav"].includes(s.mimeType)}function oe(s){f.value=s,C.value=!0}function O(){C.value=!1,f.value=null}function le(s){f.value=s}function X(s){return typeof s=="string"&&(s.startsWith("http://")||s.startsWith("https://"))}return de(()=>{E()}),(s,t)=>(n(),o("div",he,[e("div",be,[e("div",ge,[P(me,{items:ee.value},null,8,["items"])])]),z.value?(n(),o("div",ye,[e("div",we,[t[2]||(t[2]=e("div",{class:"spinner spinner-lg"},null,-1)),e("p",null,l(s.$t("common.loading")),1)])])):x.value&&!r.value?(n(),o("div",_e,[e("div",ke,[t[3]||(t[3]=D('<div class="error-icon" data-v-1bc9e78b><svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" data-v-1bc9e78b><circle cx="12" cy="12" r="10" data-v-1bc9e78b></circle><line x1="12" y1="8" x2="12" y2="12" data-v-1bc9e78b></line><line x1="12" y1="16" x2="12.01" y2="16" data-v-1bc9e78b></line></svg></div><h2 data-v-1bc9e78b>حدث خطأ</h2>',2)),e("p",null,l(x.value),1),e("button",{class:"btn btn-primary",onClick:E},l(s.$t("common.retry")),1)])])):r.value?(n(),o("div",xe,[e("div",Ce,[e("div",Be,[e("div",Me,[e("div",Ve,[e("span",{class:"item-type-badge",style:re({backgroundColor:se.value})},l(N.value),5),e("button",{class:"btn btn-secondary btn-sm",onClick:H},[...t[4]||(t[4]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("polyline",{points:"15 18 9 12 15 6"})],-1),c(" العرض البسيط ",-1)])])]),e("h1",Ie,l(B.value),1),e("div",Fe,[M.value.length>0?(n(),o("span",Te,[t[5]||(t[5]=e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),e("circle",{cx:"12",cy:"7",r:"4"})],-1)),c(" "+l(M.value.join("، ")),1)])):b("",!0),V.value?(n(),o("span",ze,[t[6]||(t[6]=D('<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-1bc9e78b><rect x="3" y="4" width="18" height="18" rx="2" ry="2" data-v-1bc9e78b></rect><line x1="16" y1="2" x2="16" y2="6" data-v-1bc9e78b></line><line x1="8" y1="2" x2="8" y2="6" data-v-1bc9e78b></line><line x1="3" y1="10" x2="21" y2="10" data-v-1bc9e78b></line></svg>',1)),c(" "+l(V.value),1)])):b("",!0),I.value?(n(),o("span",je,[t[7]||(t[7]=e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),e("polyline",{points:"9 22 9 12 15 12 15 22"})],-1)),c(" "+l(I.value),1)])):b("",!0)])])])]),e("div",$e,[e("div",Se,[e("div",De,[e("main",Ne,[(n(!0),o(y,null,F(te.value,(a,u)=>(n(),o("div",{key:u,class:"metadata-section"},[e("div",Ae,[e("h2",Ee,[t[8]||(t[8]=e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),e("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})],-1)),c(" "+l(a.title),1)])]),e("div",Le,[e("table",Re,[e("tbody",null,[(n(!0),o(y,null,F(a.fields,d=>(n(),o("tr",{key:d.key},[e("th",null,l(d.label),1),e("td",null,[Array.isArray(d.value)?(n(),o("div",He,[(n(!0),o(y,null,F(d.value,(v,$)=>(n(),o("span",{key:$,class:"value-tag"},[X(v)?(n(),o("a",{key:0,href:v,target:"_blank",rel:"noopener"},l(v),9,Oe)):(n(),o(y,{key:1},[c(l(v),1)],64))]))),128))])):(n(),o(y,{key:1},[X(d.value)?(n(),o("a",{key:0,href:d.value,target:"_blank",rel:"noopener",class:"value-link"},l(d.value),9,Xe)):(n(),o("span",Ge,l(d.value),1))],64))])]))),128))])])])]))),128)),C.value&&f.value?(n(),o("div",Ue,[e("div",We,[e("h2",Je,[t[9]||(t[9]=e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),e("circle",{cx:"12",cy:"12",r:"3"})],-1)),c(" عرض الملف: "+l(f.value.name),1)]),e("button",{class:"btn btn-close-viewer",onClick:O},[...t[10]||(t[10]=[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1),c(" إغلاق العرض ",-1)])])]),e("div",Ke,[P(pe,{files:g.value,"selected-file":f.value,onClose:O,onDownload:L,onSelectFile:le},null,8,["files","selected-file"])])])):b("",!0),g.value.length>0?(n(),o("div",qe,[e("div",Pe,[e("h2",Qe,[t[11]||(t[11]=e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e("polyline",{points:"14 2 14 8 20 8"})],-1)),c(" الملفات المرفقة ("+l(g.value.length)+") ",1)])]),e("div",Ye,[e("div",Ze,[(n(!0),o(y,null,F(g.value,a=>{var u;return n(),o("div",{key:a.id,class:ue(["file-item",{"is-selected":((u=f.value)==null?void 0:u.id)===a.id&&C.value}])},[t[15]||(t[15]=e("div",{class:"file-icon"},[e("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[e("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e("polyline",{points:"14 2 14 8 20 8"})])],-1)),e("div",et,[e("span",tt,l(a.name),1),e("span",st,[c(l(ie(a.sizeBytes))+" ",1),t[12]||(t[12]=e("span",{class:"separator"},"•",-1)),c(" "+l(a.mimeType),1)])]),e("div",it,[ae(a)?(n(),o("button",{key:0,class:"btn btn-view-file",onClick:d=>oe(a)},[...t[13]||(t[13]=[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),e("circle",{cx:"12",cy:"12",r:"3"})],-1),e("span",null,"عرض",-1)])],8,at)):b("",!0),e("button",{class:"btn btn-download-file",onClick:d=>L(a)},[...t[14]||(t[14]=[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e("polyline",{points:"7 10 12 15 17 10"}),e("line",{x1:"12",y1:"15",x2:"12",y2:"3"})],-1),e("span",null,"تحميل",-1)])],8,ot)])],2)}),128))])])])):b("",!0)]),e("aside",lt,[e("div",nt,[t[18]||(t[18]=e("h3",{class:"sidebar-title"},"الإجراءات",-1)),e("div",dt,[e("button",{class:"action-btn",onClick:H},[...t[16]||(t[16]=[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),e("circle",{cx:"12",cy:"12",r:"3"})],-1),c(" عرض المستند ",-1)])]),e("button",{class:"action-btn",onClick:t[0]||(t[0]=a=>R(s.window.location.href))},[...t[17]||(t[17]=[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}),e("path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"})],-1),c(" نسخ الرابط ",-1)])])])]),e("div",rt,[t[19]||(t[19]=e("h3",{class:"sidebar-title"},"الاقتباس",-1)),e("div",ct,[e("p",ut,[c(l(M.value.join("، "))+" ("+l(V.value)+"). ",1),e("em",null,l(B.value),1),c(". "+l(I.value)+". ",1)]),e("button",{class:"btn btn-secondary btn-sm btn-full",onClick:t[1]||(t[1]=a=>R(`${M.value.join("، ")} (${V.value}). ${B.value}. ${I.value}.`))},l(j.value?"تم النسخ!":"نسخ الاقتباس"),1)])]),t[20]||(t[20]=D('<div class="sidebar-card" data-v-1bc9e78b><h3 class="sidebar-title" data-v-1bc9e78b>تصدير البيانات</h3><div class="export-buttons" data-v-1bc9e78b><button class="export-btn" data-v-1bc9e78b><span class="format" data-v-1bc9e78b>RIS</span><span class="label" data-v-1bc9e78b>EndNote</span></button><button class="export-btn" data-v-1bc9e78b><span class="format" data-v-1bc9e78b>BibTeX</span><span class="label" data-v-1bc9e78b>LaTeX</span></button><button class="export-btn" data-v-1bc9e78b><span class="format" data-v-1bc9e78b>XML</span><span class="label" data-v-1bc9e78b>Dublin Core</span></button></div></div>',1))])])])])])):b("",!0)]))}},kt=fe(vt,[["__scopeId","data-v-1bc9e78b"]]);export{kt as default};
